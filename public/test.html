<!DOCTYPE html>
<html>
<head>
    <title>Radio Stream Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a1a; color: white; }
        .test-section { margin: 20px 0; padding: 15px; background: #2a2a2a; border-radius: 8px; }
        button { padding: 10px 20px; margin: 5px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #2563eb; }
        .status { margin: 10px 0; padding: 10px; background: #374151; border-radius: 4px; }
        .error { background: #dc2626; }
        .success { background: #16a34a; }
    </style>
</head>
<body>
    <h1>Radio Stream Test</h1>
    
    <div class="test-section">
        <h2>Direct Stream (CORS Error Expected)</h2>
        <button onclick="testDirect()">Test Direct URL</button>
        <div id="directStatus" class="status">Not tested</div>
        <audio id="directAudio" controls style="width: 100%; margin-top: 10px;"></audio>
    </div>
    
    <div class="test-section">
        <h2>Proxied Stream (Should Work)</h2>
        <button onclick="testProxy()">Test Proxy URL</button>
        <div id="proxyStatus" class="status">Not tested</div>
        <audio id="proxyAudio" controls style="width: 100%; margin-top: 10px;"></audio>
    </div>

    <script src="/test-radio.js"></script>
    <script>
        const originalUrl = 'https://icecast.walmradio.com:8443/christmas';
        const proxyUrl = '/api/proxy/icecast.walmradio.com:8443/christmas';
        
        function testDirect() {
            const audio = document.getElementById('directAudio');
            const status = document.getElementById('directStatus');
            
            status.textContent = 'Testing direct stream...';
            status.className = 'status';
            
            audio.src = originalUrl;
            audio.crossOrigin = 'anonymous';
            
            audio.addEventListener('error', function(e) {
                console.error('Direct stream error:', e);
                status.textContent = `Direct stream failed: ${audio.error ? audio.error.message : 'Unknown error'} (Expected CORS error)`;
                status.className = 'status error';
            });
            
            audio.addEventListener('loadeddata', function() {
                status.textContent = 'Direct stream loaded successfully!';
                status.className = 'status success';
            });
            
            audio.addEventListener('loadstart', function() {
                status.textContent = 'Loading direct stream...';
            });
            
            audio.load();
        }
        
        function testProxy() {
            const audio = document.getElementById('proxyAudio');
            const status = document.getElementById('proxyStatus');
            
            status.textContent = 'Testing proxied stream...';
            status.className = 'status';
            
            audio.src = proxyUrl;
            
            audio.addEventListener('error', function(e) {
                console.error('Proxy stream error:', e);
                status.textContent = `Proxy stream failed: ${audio.error ? audio.error.message : 'Unknown error'}`;
                status.className = 'status error';
            });
            
            audio.addEventListener('loadeddata', function() {
                status.textContent = 'Proxy stream loaded successfully!';
                status.className = 'status success';
            });
            
            audio.addEventListener('loadstart', function() {
                status.textContent = 'Loading proxied stream...';
            });
            
            audio.load();
        }
        
        // Run automated tests when page loads
        window.addEventListener('load', function() {
            console.log('ðŸš€ Running automated radio streaming test...');
            
            setTimeout(() => {
                testProxy();
                setTimeout(() => {
                    testDirect();
                }, 2000);
            }, 1000);
        });
    </script>
</body>
</html>